@model MiGenteEnLinea.Web.Models.ViewModels.RegisterViewModel
@{
    ViewData["Title"] = "Crea tu Cuenta";
    Layout = null; // Register page sin layout
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Mi Gente en Línea</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" />
    <link href="~/css/animated.css" rel="stylesheet" />
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.css" />
    
    <style>
        /* Contenedor principal */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Imagen de fondo */
        .login-bg {
            background-image: url('/images/MainBanner2.jpg');
            background-size: contain;
            background-position: left;
            background-repeat: no-repeat;
            background-attachment: fixed;
            height: 100vh;
        }

        /* Formulario centrado */
        .login-card {
            background-color: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            z-index: 2;
            border-radius: 12px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
        }

        /* Estilo responsivo para móviles */
        @@media (max-width: 767.98px) {
            .login-bg {
                display: none;
            }

            .login-container {
                padding: 15px;
                background-color: #f8f9fa;
            }
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Imagen de fondo -->
            <div class="col-lg-8 d-none d-lg-block position-relative login-bg">
                <div class="overlay"></div>
                <img src="~/images/logoMiGene.png" width="200" alt="Mi Gente Logo" />
            </div>

            <!-- Formulario de Registro -->
            <div class="col-lg-4 col-12 login-container">
                <div class="login-card shadow-lg">
                    <h4>Registra tu Cuenta</h4>
                    <hr />
                    
                    <div id="loginForm" class="login-form animate__animated animate__flipInY">
                        <a href="https://www.migenteenlinea.do" target="_parent">
                            <div style="text-align: center" class="d-md-none">
                                <img src="~/images/logoMiGene.png" alt="Mi Gente Logo" />
                            </div>
                        </a>

                        <form asp-action="Register" asp-controller="Auth" method="post">
                            @Html.AntiForgeryToken()

                            <div class="form-group">
                                <label asp-for="TipoCuenta">Tipo de Cuenta</label>
                                <select asp-for="TipoCuenta" class="form-select">
                                    <option value="">Seleccione el Tipo de Perfil</option>
                                    <option value="1">Empleador</option>
                                    <option value="2">Ofertante</option>
                                </select>
                                <span asp-validation-for="TipoCuenta" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label asp-for="Nombre">Nombre</label>
                                <input asp-for="Nombre" class="form-control" placeholder="Nombre" />
                                <span asp-validation-for="Nombre" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label asp-for="Apellido">Apellido</label>
                                <input asp-for="Apellido" class="form-control" placeholder="Apellido" />
                                <span asp-validation-for="Apellido" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label asp-for="Email">Email</label>
                                <input asp-for="Email" class="form-control" placeholder="Email" />
                                <span asp-validation-for="Email" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label asp-for="Telefono1">Teléfono 1</label>
                                <input asp-for="Telefono1" class="form-control" placeholder="Teléfono 1" />
                                <span asp-validation-for="Telefono1" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label asp-for="Telefono2">Teléfono 2</label>
                                <input asp-for="Telefono2" class="form-control" placeholder="Teléfono 2 (opcional)" />
                                <span asp-validation-for="Telefono2" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fa fa-user-plus"></i> Crear Cuenta
                                </button>
                            </div>

                            <div class="form-group text-center">
                                <a href="@Url.Action("Login", "Auth")" class="text-primary">¿Ya tienes cuenta? Inicia sesión</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- SweetAlert2 JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.js"></script>

    <!-- Validation Scripts -->
    <partial name="_ValidationScriptsPartial" />

    <script>
        // Función para reenviar correo de activación
        function resendActivationEmail(userId, email) {
            $.ajax({
                url: '@Url.Action("ResendActivation", "Auth")',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ userId: userId, email: email }),
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            title: 'Correo Reenviado',
                            text: response.message,
                            icon: 'success',
                            confirmButtonText: 'Aceptar'
                        });
                    } else {
                        Swal.fire({
                            title: 'Error',
                            text: response.message,
                            icon: 'error',
                            confirmButtonText: 'Aceptar'
                        });
                    }
                },
                error: function () {
                    Swal.fire({
                        title: 'Error',
                        text: 'Hubo un problema al reenviar el correo',
                        icon: 'error',
                        confirmButtonText: 'Aceptar'
                    });
                }
            });
        }

        // Mostrar mensajes de éxito
        @if (TempData["SuccessMessage"] != null)
        {
            <text>
            Swal.fire({
                title: 'Éxito',
                text: '@TempData["SuccessMessage"]',
                icon: 'success',
                confirmButtonText: 'Aceptar'
            });
            </text>
        }

        // Mostrar errores desde TempData
        @if (TempData["ErrorType"] != null)
        {
            var errorType = TempData["ErrorType"]?.ToString() ?? "unknown";
            var errorMessage = TempData["ErrorMessage"]?.ToString() ?? "Error desconocido";
            var showResend = TempData["ShowResend"] != null && (TempData["ShowResend"] as bool? ?? false);
            var userId = TempData["UserId"]?.ToString() ?? "";
            var email = TempData["Email"]?.ToString() ?? "";

            if (errorType == "inactive_exists" && showResend)
            {
                <text>
                Swal.fire({
                    title: 'Dirección de Correo Existente',
                    text: '@errorMessage',
                    icon: 'error',
                    showCancelButton: true,
                    confirmButtonText: 'Aceptar',
                    cancelButtonText: 'Reenviar correo de activación'
                }).then((result) => {
                    if (result.dismiss === Swal.DismissReason.cancel) {
                        resendActivationEmail('@userId', '@email');
                    }
                });
                </text>
            }
            else
            {
                var titleText = errorType == "exists" ? "Dirección de Correo Existente" : "Error";
                <text>
                Swal.fire({
                    title: '@titleText',
                    text: '@errorMessage',
                    icon: 'error',
                    confirmButtonText: 'Aceptar'
                });
                </text>
            }
        }
    </script>
</body>
</html>
